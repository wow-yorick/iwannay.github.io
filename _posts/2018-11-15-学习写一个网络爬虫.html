<p>
  &#x2014; layout: post title: 学习写一个网络爬虫 &#x2014;
</p>

<div id="outline-container-orgbe2ddc1" class="outline-2">
  <h2 id="orgbe2ddc1">
    <span class="section-number-2">1</span> 来源
    <a href="https://github.com/gopcp">go并发编程实例</a>
  </h2>
</div>

<div id="outline-container-org20b38d1" class="outline-2">
  <h2 id="org20b38d1">
    <span class="section-number-2">2</span> 起始于首次请求的数据流程图
  </h2>
  <div class="outline-text-2" id="text-2">
    <div class="figure">
      <p><img src="./images/spider-0.png" alt="spider-0.png" /></p>
    </div>
  </div>
</div>

<div id="outline-container-org43f109b" class="outline-2">
  <h2 id="org43f109b">
    <span class="section-number-2">3</span> 调度器与各处理模块的关系
  </h2>
  <div class="outline-text-2" id="text-3">
    <div class="figure">
      <p><img src="./images/spider-1.png" alt="spider-1.png" /></p>
    </div>
  </div>
</div>

<div id="outline-container-orgdb56093" class="outline-2">
  <h2 id="orgdb56093"><span class="section-number-2">4</span> 基本数据结构</h2>
  <div class="outline-text-2" id="text-4">
    <p>
      <code>Request</code> 数据的请求 <code>Response</code> 数据的响应
      <code>Item</code> 条目结构 <code>Error</code> 错误的类型 包含（ 错误的类型
      错误的提示信息 完整的错误提示信息）
    </p>
  </div>
</div>

<div id="outline-container-org6769b86" class="outline-2">
  <h2 id="org6769b86"><span class="section-number-2">5</span> 架构设计</h2>
  <div class="outline-text-2" id="text-5"></div>
  <div id="outline-container-orgb20dac3" class="outline-4">
    <h4 id="orgb20dac3">
      <span class="section-number-4">5.0.1</span> 处理模块的抽象接口声明
      <code>Module</code>
    </h4>
    <div class="outline-text-4" id="text-5-0-1">
      <ul class="org-ul">
        <li><code>ID() MID</code> 获取当前组件的ID</li>
        <li><code>Addr() string</code> 获取当前组件的网站地址</li>
        <li><code>Score() uint64</code> 获取当前组件的评分</li>
        <li><code>SetScore(score unit64)</code> 设置当前组件的评分</li>
        <li><code>ScoreCalculator() CalculateScore</code> 获取评分计算器</li>
        <li><code>CalledCount() uint64</code> 获取当前组件被调用的计数</li>
        <li><code>AcceptedCount() uint64</code> 接受调用的次数</li>
        <li><code>CompletedCount() uint64</code> 成功完成的调用计数</li>
        <li><code>HandlingNumber() uint64</code> 正在处理的调用数</li>
        <li><code>Counts() Counts</code> 获取所有的计数信息</li>
        <li><code>Summary() SummaryStruct</code> 获取组件摘要</li>
      </ul>
    </div>
  </div>

  <div id="outline-container-org55d2d0f" class="outline-4">
    <h4 id="org55d2d0f">
      <span class="section-number-4">5.0.2</span> 序列号生成器的接口设计
      <code>SNGenertor</code>
    </h4>
    <div class="outline-text-4" id="text-5-0-2">
      <ul class="org-ul">
        <li><code>Start() unit64</code> 获取预设的最小序列号</li>
        <li><code>Max() unit64</code> 获取预设的最大序列号</li>
        <li><code>Next() unit64</code> 下一个序列号</li>
        <li><code>CycleCount() uint64</code> 获取循环计数</li>
        <li><code>Get() uint64</code> 获取一个序列号并准备下一个序列号</li>
      </ul>

      <p>
        组件ID的构成及生成方法
        <img src="./images/spider-2.png" alt="spider-2.png" />
      </p>
    </div>
  </div>

  <div id="outline-container-org87e1f5f" class="outline-3">
    <h3 id="org87e1f5f"><span class="section-number-3">5.1</span> 下载器</h3>
    <div class="outline-text-3" id="text-5-1">
      <div class="org-src-container">
        <pre class="src src-go">
type Downloader interface {
Module
Download(req *Request) (*Response, error)
}
</pre
        >
      </div>
    </div>
  </div>
  <div id="outline-container-orge7e51cb" class="outline-3">
    <h3 id="orge7e51cb"><span class="section-number-3">5.2</span> 分析器</h3>
    <div class="outline-text-3" id="text-5-2">
      <div class="org-src-container">
        <pre class="src src-go">
type ParseResponse func(httpResp *http.Response, respDepth uint32) ([]Data, []error)

type Analyzer interface {
Module
//返回当前分析器使用的响应解析函数的列表
RespParsers() []ParseResponse
//响应需要分别经过若干响应解析函数的处理，然后合并结果
Analyze(resp *Response) ([]Data, []error)
}
</pre
        >
      </div>
    </div>
  </div>
  <div id="outline-container-orgfccffb0" class="outline-3">
    <h3 id="orgfccffb0">
      <span class="section-number-3">5.3</span> 条目处理管道
    </h3>
    <div class="outline-text-3" id="text-5-3">
      <div class="org-src-container">
        <pre class="src src-go">
type Pipeline interface {
Module

//返回当前条目处理管道使用的条目处理函数列表
ItemProcessors() []ProcessItem

//向条目处理管道发送条目
Send(item Item) []error

//是否遇到失败终止
FailFast() bool

//设置是否快速失败
SetFailFast(failFast bool)
}

type ProcessItem func(item Item) (result Item, err error)
</pre
        >
      </div>
    </div>
  </div>
  <div id="outline-container-org6b282b3" class="outline-3">
    <h3 id="org6b282b3"><span class="section-number-3">5.4</span> 调度器</h3>
    <div class="outline-text-3" id="text-5-4">
      <div class="org-src-container">
        <pre class="src src-go">
type Scheduler interface {
Init(requestArgs RequestArgs, dataArgs DataArgs, moduleArgs ModuleArgs) (err error)

//以首次请求为起点开始爬取
Start(firstHTTPReq *http.Request) (err error)

Stop()(err error)

//获取调度器状态
Status()Status

//接受错误的通道 若结果为nil 说明通道不可用或调度器已停止
ErrorChan() &lt;-chan error

// 判断所有处理模块是否都处于空闲状态
Idle() bool

//获取摘要实例
Summary() SchedSummary
}

</pre
        >
      </div>
    </div>

    <div id="outline-container-orgce39b9e" class="outline-4">
      <h4 id="orgce39b9e">
        <span class="section-number-4">5.4.1</span> 调度器的状态转换
      </h4>
      <div class="outline-text-4" id="text-5-4-1">
        <div class="figure">
          <p><img src="./images/spider-3.png" alt="spider-3.png" /></p>
        </div>
      </div>
    </div>
  </div>
</div>
